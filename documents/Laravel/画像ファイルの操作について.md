# 画像ファイルの操作について

## アップロード(HTML側)

ユーザーは、フォーム送信でサーバ側に画像ファイルを送信することができる。

以下のように、formタグに`enctype="multipart/form-data"`と設定することでバイナリファイルの送信を許可して、inputタグのtype属性に"file"を指定する（例：`accept=".gif`）。accept属性で、ファイルの拡張子を制限できる。MIMEタイプでも指定できる（例：`accept="image/png, image/jpeg"`）。
```
<form action="" method="POST" enctype="multipart/form-data" accept=".png, .jpg, .pdf">

...

<input type="file" name="">

...

</form>
```

## アップロード(Laravel側)

フォーム送信されたファイルは、テキストのフォーム情報同様、Requestクラスに格納される。以下のように、$requestのfileメソッドで、引数の名前で送信されたファイルを操作するオブジェクトが取得できる。fileオブジェクトのmoveメソッドで、そのファイルをアプリケーション内に保存できる。

```
// 利用例
$image_file = $request->file('image_file');

$image_filename = Carbon::now()->format('YmdHis-').str_pad(rand(0,9999), 4, 0, STR_PAD_LEFT).'.'.$image_file->extension();
$image_file->move(storage_path('app/public/img'), $image_filename);
```

## アプリ内でのファイル操作

Illuminate\Support\Facades\Storage クラスを使う。  
公式ドキュメント：https://readouble.com/laravel/8.x/ja/filesystem.html

- Storageクラスは、diskと呼ばれる設定情報（保存するファイルのパスとか）に従って処理を行う。
  - diskの設定は、config/filesystem.php に記述され、複数のdisk設定が連想配列で保存されている。デフォルトで利用されるdiskの設定は、.envのFILESYSTEM_DRIVERという項目で設定する。
  - `Storage::disk('local')->hoge();`というように、使いたいメソッドの前で呼び出す。また以下のように、diskをセットした状態を変数にして使いまわすこともできる。

  ```
  // 利用例
  $storage = Storage::disk('public');

  $storage->move('hogehoge', 'hugahuga');
  ```

- ファイルを移動したい場合、対象のファイルのパス、移動先のパスを指定する。
  - （例）： `Storage::move('temp/'.$image_filename, 'img/'.$image_filename);`

- ファイルを削除したい場合、対象のファイルのパスを指定する。
  - （例）： `Storage::delete('img/'.$image->image_filename);`







