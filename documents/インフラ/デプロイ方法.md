# 各環境のデプロイ方法

## ローカル環境のデプロイ方法（環境構築の手順）

README.md のローカル環境構築の手順を参照。

## 開発環境へのデプロイ方法（本番サーバー）

1. `web/test-host/web/admin`に移動して、以下のコマンドを実行（Webアプリを停止する）
- `php artisan down`

2. 本番サーバーにWinSCPでアクセスする。（WinSCPの使い方は本番環境.mdを参照）

3. `web/test-host/`の、以下のファイルのバックアップを取る
- `web/admin/.env`
- `web/admin/.htpasswd`
- `web/admin/public/.htaccess`

4. 更新するファイル・フォルダをアップロード

5. リポジトリの内容をそのままアップロードした場合、余分なファイルが存在するので、`web/test-host/`の、以下のファイルを削除する。
- .envの環境ごとの差分ファイル
  - `web/admin/.env.local.example`
  - `web/admin/.env.mikawaya-corp.example`
  - `web/admin/.env.test-host.example`
- .htaccessの環境ごとの差分ファイル
  - `web/admin/public/.htaccess.local.example`
  - `web/admin/public/.htaccess.mikawaya-corp.example`
  - `web/admin/public/.htaccess.test-host.example`

6. キャッシュをクリアするため、以下のコマンドを実行
- アプリキャッシュのクリア  
  `php artisan cache:clear`  

- viewキャッシュのクリア  
  `php artisan view:clear`  

- configキャッシュのクリア  
  `php artisan config:cache`  

- routeキャッシュのクリア  
  `php artisan route:cache`  

7. 手順3でバックアップをとったファイルを元の場所に戻す

8. `web/test-host/web/admin`に移動して、以下のコマンドを実行（Webアプリを再開する）
- `php artisan up`

## 本番環境へのデプロイ方法（本番サーバー）

「開発環境へのデプロイ方法」と同じ。（test-hostの部分をmikawaya-corpに置き換える）
